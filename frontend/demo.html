<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Face Comparison Demo</title>
  <style>
    body {
      font-family: Arial, sans-serif;
    }
    video, canvas, img {
      border: 1px solid #ccc;
      margin: 5px;
    }
    .container {
      margin-bottom: 20px;
    }
    code {
      display: block;
      background: #f5f5f5;
      padding: 10px;
      border-left: 4px solid #888;
      white-space: pre-wrap;
      margin-bottom: 15px;
    }
    pre#result {
      background: #fff;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
  </style>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar">
  <ul>
    <li><a href="index.html">Emotion Detection</a></li>
    <li><a href="analyze.html">Age/Gender Detection</a></li>
    <li><a href="about.html">About</a></li>
    <li><a href="login.html">Login</a></li>
    <li><a href="register.html">Register</a></li>
    <li><a href="profile.html">Profile</a></li>
    <li><a href="demo.html">Demo</a></li>
  </ul>
</nav>
<hr class="nav-divider">

<h1>Face Comparison Demo</h1>

<div class='container'>
  <h2>Image 1</h2>
  <input type="file" id="file1" accept="image/*"><br>
  <button onclick="clearImage(1)">Clear Image 1</button><br>
  <video id="video1" width="320" height="240" autoplay playsinline></video>
  <button onclick="captureFromWebcam(1)">Capture from Webcam 1</button>
</div>

<div class='container'>
  <h2>Image 2</h2>
  <input type="file" id="file2" accept="image/*"><br>
  <button onclick="clearImage(2)">Clear Image 2</button><br>
  <video id="video2" width="320" height="240" autoplay playsinline></video>
  <button onclick="captureFromWebcam(2)">Capture from Webcam 2</button>
</div>

<br><br>
<button onclick="compareFaces()">Compare Faces</button>

<h3>Results:</h3>
<pre id="result"><code>No comparison made yet.</code></pre>

<script>
  let img1 = null, img2 = null;

  async function startWebcams() {
    const stream = await navigator.mediaDevices.getUserMedia({ video: true });
    document.getElementById("video1").srcObject = stream;
    document.getElementById("video2").srcObject = stream;
  }

  function captureFromWebcam(num) {
    const video = document.getElementById("video" + num);
    const canvas = document.createElement("canvas");
    canvas.width = 320;
    canvas.height = 240;
    const ctx = canvas.getContext("2d");
    ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
    const imgData = canvas.toDataURL("image/jpeg");

    if (num === 1) {
      img1 = imgData;
    } else {
      img2 = imgData;
    }

    alert(`Captured Image ${num}`);
  }

  function clearImage(num) {
    if (num === 1) {
      img1 = null;
      document.getElementById("file1").value = '';
    } else {
      img2 = null;
      document.getElementById("file2").value = '';
    }
    alert(`Cleared Image ${num}`);
  }

  document.getElementById('file1').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = () => img1 = reader.result;
    reader.readAsDataURL(e.target.files[0]);
  });

  document.getElementById('file2').addEventListener('change', function (e) {
    const reader = new FileReader();
    reader.onload = () => img2 = reader.result;
    reader.readAsDataURL(e.target.files[0]);
  });

  async function compareFaces() {
    if (!img1 || !img2) {
      alert("Please provide both images.");
      return;
    }

    document.getElementById("result").innerHTML = "<code>Processing...</code>";

    try {
      const response = await fetch("http://127.0.0.1:5000/api/demo_compare", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ image1: img1, image2: img2 })
      });

      const data = await response.json();

      const outputHTML = `
<code>Base64 Image 1 (first 100 chars):\n${data.base64_sample_img1}</code>
<code>Base64 Image 2 (first 100 chars):\n${data.base64_sample_img2}</code>

<code>NumPy Array Sample - Image 1:\n${data.array_sample_img1}</code>
<code>NumPy Array Sample - Image 2:\n${data.array_sample_img2}</code>

<code>DeepFace Results:\n- Similarity Score: ${data.similarity}\n- Confidence Score: ${data.confidence !== null ? data.confidence : "N/A"}\n- Verified Match: ${data.verified ? "Yes" : "No"}</code>
      `;

      document.getElementById("result").innerHTML = outputHTML;
    } catch (error) {
      document.getElementById("result").innerHTML = "<code>Error processing images.</code>";
    }
  }

  startWebcams();
</script>
</body>
</html>
